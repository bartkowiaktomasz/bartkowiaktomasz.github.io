<!DOCTYPE html>
<html>
<head>
	<title>BLE DEVICE</title>
	<style>
		body{
			font-family: Helvetica;
			text-align:center;
		}
		ol{
			width:400px;
			text-align:left;
			margin:0 auto;
		}
	</style>
</head>
<body>
	<h1>BLE Devices</h1>
	<ol>
		<li>Click <button id="connect">Connect</button></li>
	</ol>
	<script>
		window.onload = () => {
			document.getElementById('connect').onclick = connectBLE;
		}
    
    function connectBLE() {
      let filters = [];

      let filterService = document.querySelector('#service').value;
      if (filterService.startsWith('0x')) {
        filterService = parseInt(filterService);
      }
      if (filterService) {
        filters.push({services: [filterService]});
      }

      let filterName = document.querySelector('#name').value;
      if (filterName) {
        filters.push({name: filterName});
      }

      let filterNamePrefix = document.querySelector('#namePrefix').value;
      if (filterNamePrefix) {
        filters.push({namePrefix: filterNamePrefix});
      }

      let options = {};
      if (document.querySelector('#allDevices').checked) {
        options.acceptAllDevices = true;
      } else {
        options.filters = filters;
      }

      log('Requesting Bluetooth Device...');
      log('with ' + JSON.stringify(options));
      navigator.bluetooth.requestDevice(options)
      .then(device => {
        log('> Name:             ' + device.name);
        log('> Id:               ' + device.id);
        log('> Connected:        ' + device.gatt.connected);
      })
      .catch(error => {
        log('Argh! ' + error);
      });
    }
	</script>
</body>
</html>
